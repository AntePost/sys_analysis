### DDD

## Problem space / company domain

Решение проблем усталости котов-тестировщиков, путем уменьшения сторонней работы котов (не связанной с основной деятельностью - тестированием)

## Company strategy

Привлечь лучших котов в качестве воркеров, чтобы они выполняли стороннюю работу за котов-тестировщиков (клиентов)

## Company tactics

Дать клиентам возможность оставлять заказы на выполнение сторонней работы, мэтчить лучшего воркера с клиентом и отправлять воркеров на выполнение этой сторонней работы

## Ubiquitous language

- Кот-тестировщик - работник материнской компании, может сильно уставать
- Клиент - кот-тестировщик, пользующийся услугами нашей компании
- Сторонняя работа - деятельности кота-тестировщика, не относящаяся к тестированию. Ее клиенты будут отдавать на откуп воркерам
- Соискатель - кот, подавшийся на вакансию воркера, может стать нашим воркером
- Воркер (лучший кот) - сотрудник нашей компании, выполняет заказы (стороннюю работу) клиентов
- Заказ - задача от клиента для воркера, которую воркер должен выполнить за клиента. Пример - скинуть стакан со стола
- Мэтчинг - алгоритм, который соотносит лучшего воркера (для этого заказа) с клиентом, оставившим заказ
- Отсев котов - отсев неподходящих под наши критерии соискателей

## Subdomains

Внутри поддомена перечислены его контексты

### Core

#### Orders
- Order life-cycle - создание заказа и дальнейшее выполнение заказа воркером или его отмена
- Matching - алгоритм мэтчинга клиента и подходящего воркера
- Client billing - расчет его стоимости заказа, списание денег за заказы с клиентов
- Worker billing - расчет его стоимости заказа, оплата работы воркеров

### Supporting

#### Order-package preparing
- Order package preparing - сборка расходников (включая печенье)
#### Applicants
- Applicants - размещение вакансий для воркеров, подача соискателями на вакансию, прохождение тестов, итоговый отбор соискателей
#### Bets
- Bets - ставки менеджеров на выполнение заказа для мотивации менеджеров

### Generic

#### Quality control
- Quality control - оценка качества выполненных заказов и анализ проблем, возникших в невыполненных заказах
#### Identity
- Identity - хранит данные о managers, clients, workers

## Non-functional characteristics

### Проект в целом
- Высокие agility, testability и deployability, так как нужен высокий TTM

### Core subdomain (orders)
- Высокий availability, так как это основное, что приносит деньги компании
- Scalability на текущем этапе не очень важен, так как большой нагрузки не предполагается
- В тоже время для части контекстов этом поддомене (биллинг) availability не критичен (запускается редко, стримминг ордеров можно нагнать после временной недоступности биллинга)

### Matching context
- Средне-высокий modifiability - частые ("иногда") изменения
- Высокий interoperability, так как там отдельная команда разработчиков и свой ubiquitous language

### Order price calculation

Не вынесен в отдельный контекст, находится в двух биллингах

- Средне-высокий modifiability, сейчас там примитивный алгоритм, вероятно будут доработки

### Applicants subdomain

- Высокий scalability, могут заДДОСить
- Высокие modifiability, maintainability, deployability. "Для бизнеса критично проверять новые гипотезы по отсеву котов и изменять уже существующие с максимальной скоростью и надёжностью"

## Комментарий к разбивке под поддоменам

- Так как есть заметная разница между business importance и business differentiation, то сделал 2 версии core domain charts
- Также увидел в [шаблоне](https://github.com/ddd-crew/core-domain-charts) упоминание контекстов и решил выделить контексты отдельно
- Думал над тем, чтобы контекст Order package preparing сделать частью поддомена Orders, но решил выделить отдельно, из-за отдельной позиции на domain core chart. По этой же логике выделил quality control отдельно
- Но при этом оставил billing внутри поддомена orders, хотя по той же логике его надо вынести отдельно, тем более что он имеет другие нефункциональные характеристики (см. выше). Но решил оставить, так как кажется, биллинг не решает отдельную задачу. Не уверен, как правильно
- Не уверен как быть с Order price calculation - на отдельный контекст не тянет, но судя по требованиям, функциональные характеристики отличаются

## Комментарий к изменениям в ES

- По сравнению с первой версией ЕС объединил контексты workers, clients в identity. Это только CRUD, который предоставляет данные о различных типах пользователей.
- Также убрал технические шаги в расчете ставки и биллинге воркеров, упростил quality control
- Есть подозрение, что остались технические шаги в регистрации клиентов и воркеров. Но в обоих случаях кажется нужна вторая команда, так как первое событие приходит из другого места (другой контекст или внешняя система)
- Не успел переделать визуально, чтобы был виден temporal coupling

## Комментарии к итоговой схеме

- На итоговой схеме не показано большинство доступов к БД, так как это перегружало схему. Вместо стриминга другие сервисы обращаются к таблицам другого сервиса через read-only доступ
- Для коммуникации между orders и order-package-preparing выбран синхронный подход, так как там нужна гарантия доставки, иначе ломается флоу заказа

## Выбор архитектурного стиля

- С учетом разницы функциональных характеристик между элементами монолитный стиль не подходит
- Микросервисный стиль самый сложный в реализации и из требований не видно, чтобы он был необходим, поэтому он тоже не подходит
- Таким образом был выбран компромиссный service-based стиль
- Некоторые компоненты системы, отличающиеся по характеристикам от остальной кодовой базы (matching, order-price calculation) можно вынести в отдельные библиотеки
